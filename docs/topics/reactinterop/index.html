<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">


<title data-react-helmet="true">React Interop | scalajs-reaction</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="React Interop | scalajs-reaction"><meta data-react-helmet="true" name="description" content="This is an old section and most of the content is out of date."><meta data-react-helmet="true" property="og:description" content="This is an old section and most of the content is out of date."><meta data-react-helmet="true" property="og:url" content="https://aappddeevv.github.io/scalajs-reaction/docs/topics/reactinterop">

<link data-react-helmet="true" rel="shortcut icon" href="/scalajs-reaction/img/favicon.ico">


<link rel="stylesheet" href="/scalajs-reaction/styles.031cb377.css">


<link rel="preload" href="/scalajs-reaction/styles.5c3bc461.js" as="script">

<link rel="preload" href="/scalajs-reaction/runtime~main.321c0d7a.js" as="script">

<link rel="preload" href="/scalajs-reaction/main.3c816209.js" as="script">

<link rel="preload" href="/scalajs-reaction/1.3a76b485.js" as="script">

<link rel="preload" href="/scalajs-reaction/2.bf216f74.js" as="script">

<link rel="preload" href="/scalajs-reaction/3.d2bbdf3a.js" as="script">

<link rel="preload" href="/scalajs-reaction/1be78505.128db190.js" as="script">

<link rel="preload" href="/scalajs-reaction/12747410.54802530.js" as="script">

<link rel="preload" href="/scalajs-reaction/17896441.bf8545bc.js" as="script">

<link rel="preload" href="/scalajs-reaction/1548d535.cbd99d1d.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/scalajs-reaction/"><img class="navbar__logo" src="/scalajs-reaction/img/logo.svg" alt="scalajs-reaction logo"><strong class="navbar__title">scalajs-reaction</strong></a><a class="navbar__item navbar__link" href="/scalajs-reaction/docs/intro/index">Docs</a><a class="navbar__item navbar__link" href="/scalajs-reaction/blog">Blog</a><a target="_blank" rel="noopener noreferrer" href="api/index.html" class="navbar__item navbar__link">API</a><a target="_blank" rel="noopener noreferrer" href="demo" class="navbar__item navbar__link">Demo</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/aappddeevv/scalajs-reaction" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/scalajs-reaction/"><img class="navbar__logo" src="/scalajs-reaction/img/logo.svg" alt="scalajs-reaction logo"><strong class="navbar__title">scalajs-reaction</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/scalajs-reaction/docs/intro/index">Docs</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/scalajs-reaction/blog">Blog</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/aappddeevv/scalajs-reaction" class="menu__link" position="right">GitHub</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="api/index.html" class="menu__link" position="left">API</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="demo" class="menu__link" position="left">Demo</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">React Interop</h1></header><div class="markdown"><p>This is an old section and most of the content is out of date.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="react-interop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#react-interop" title="Direct link to heading">#</a>React Interop</h1><p>The interop layer is structured much like ReasonReact so you can read those
documents to understand how scalaj-react is structured. It&#x27;s pretty much the
same thing.</p><p>A few differences:</p><ul><li>Instead of a record structure for scala side component, we use a javascript
object.</li><li>initialState takes a <code>Self</code> so you have access to callback handlders in case
any object you need to create for your state requires them. You can use the
other methods to get around this or even use mutable state (and change it
directly) in another API callback like didMount but this makes it easier.</li><li>A generator function is provided in the reducer to create the state update
messages. This is a better approach than having to create your own objects for
the state update directive.</li><li>The methods have been changed so that you are <em>only</em> provided a &quot;self&quot;
function parameter that make sense for that method. You cannot, for example,
see a &quot;state&quot; object in &quot;self&quot; if you are using a stateless component.</li><li>You are forced to defined the retained props or initial state in the &quot;new
methods&quot; call if they are required. If you have a stateful comonent, you must
define them. Mandatory fields on &quot;methods&quot; are indicated by a val as show below.</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">case class MyState(...)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val c = reducerComponent[MyState](&quot;component&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import c.ops._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def make(...) = c.copy(new methods {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val initialState = MyState()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val render = self =&gt; { ... }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ref-and-key"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ref-and-key" title="Direct link to heading">#</a>Ref and Key</h2><p>Ref and key are special properties used by react to assist in accessing the
component instance or managing arrays of values. These properties are ripped out
of props and processed special by reactjs.</p><p>Model ref and key explicitly in your SFC props.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="suspense"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#suspense" title="Direct link to heading">#</a>Suspense</h2><p>Suspense allows you to delay rendering until a js.Promise completes. In the
react rendering engine, suspended components continue to display their content
until the effect completion, with a possible fallback in case the effect
fails. This allows you to continue to show user relevant content until the
rendering completes. While you can do some of this today, without using
suspense, the user-experience is bit jerky. You throw the promise in the
rendering function.</p><p>There are a couple of complications.</p><ul><li>You cannot throw a raw promise in scala.js. It&#x27;s always wrapped up before it
hits the js side.</li><li>You cannot call <code>import</code> as a function as its really a keyword in javascript
now.</li></ul><p>To use Suspense and React.lazy, you&#x27;ll need to do one of a few different
approaches:</p><ul><li>Create a .ts/.js file that exports a component that is created using
<code>React.lazy</code>. The component needs to be non-scalajs component since scalajs
bundles <em>everything</em> together. Import that component as a ReactLazyComponent
and then call <code>wrapJsForScala</code> to create a scala component.</li><li>Create a .ts/.js file and include only exports of the form <code>() =&gt;
import(&quot;amodule&quot;)</code>. The import type is DynamicImportThunk and that can used as
an argument to scala&#x27;s <code>React.lazy</code>. You need to define it as a function so
the ts/js Promise is not started immediately. Since you are created deferred
computations, you can define as many of these as you want in a single file and
import them all at once.</li><li>Externalize the entire Suspense and React.lazy machine and just import a
component from a js/ts module in its entirety.</li></ul><p>In react 16.8, only lazy loading is supported but any component that throws a
javascript Promise can be used which is how React.lazy and dynamic imports
work. Creating a dynamic import creates as javascript Promise that resolves to
the module content.</p><p>Since scala cannot throw a raw javascript Promise, you can create a lazy
component by throwing inside a ts/js defined Component. The demo shows how this
can be done in ts/js. This also means that if you use Suspense, the chain of
parent components must not be a Component object since a <code>didCatch</code> proxy is
installed and once that handler is used, you cannot rethrow easily into the js
world again. Hence, you any component that implements the <code>throwit</code> trick below
must check for a Promise object and throw it in the javascript world and so
on. Since this is a bit awkward, it is suggested that your Promise throwing
component be defined using <code>SFC</code>, which is a pure javscript function component,
not a Component (in this facade), and that it be a direct child of a Suspense
component.</p><p>As a trick, you can define an scala import module that imports a single function
that throws an object for you.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">default</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">throwit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> e </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>then import it</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@js.native</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@JSImport(&quot;throwit&quot;, JSImport.Default)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">object throwit { </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   def apply(t: js.Any): Unit = js.native</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Then throw it in your function, such as a SFC</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val sfc = SFC[js.Object]{ _ =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val x = throwit(..code that creates a promise...)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  div(&quot;My nodes to display&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>But the trick is to have a js.Promise that is smart enough to resolve once the
content has been loaded. This typically uses a backing store of some sort
e.g. cache. If you naviavely try this and its a new promise that never completes
(resolve or fail), you may hang the UI at some point since the promise never
completes.</p><p>It&#x27;s not clear how useful this all is although the lazy loading use case is
interesting in a mixed project.</p><p>Because of the Suspense feature, <code>didCatch</code> has been removed from scala
Components until the interaction between them is better understood.</p><p>We suggest you look at other libraries that may be easier to use such as
<a href="https://www.smooth-code.com/open-source/loadable-components/">loadable
components</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/aappddeevv/scalar2020online/edit/master/presentation/docs/topics/reactinterop.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#ref-and-key" class="contents__link">Ref and Key</a></li><li><a href="#suspense" class="contents__link">Suspense</a></li></ul></div></div></div></div></main></div></div>
</div>

<script src="/scalajs-reaction/styles.5c3bc461.js"></script>

<script src="/scalajs-reaction/runtime~main.321c0d7a.js"></script>

<script src="/scalajs-reaction/main.3c816209.js"></script>

<script src="/scalajs-reaction/1.3a76b485.js"></script>

<script src="/scalajs-reaction/2.bf216f74.js"></script>

<script src="/scalajs-reaction/3.d2bbdf3a.js"></script>

<script src="/scalajs-reaction/1be78505.128db190.js"></script>

<script src="/scalajs-reaction/12747410.54802530.js"></script>

<script src="/scalajs-reaction/17896441.bf8545bc.js"></script>

<script src="/scalajs-reaction/1548d535.cbd99d1d.js"></script>


</body>
</html>